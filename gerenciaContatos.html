<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>OnTrack</title>

    <link rel="stylesheet" href="assets/vendor/fontawesome-free/css/all.min.css" type="text/css">
    <link rel="stylesheet" href="assets/css/navbar.css" type="text/css">
    <link rel="stylesheet" href="assets/css/snippet.css" type="text/css">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.1.1/aos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css">
</head>

<body id="page-top" class="sidebar-toggled">

    <div class="mobile-menu">
        <ul class="bottom-navbar-nav">
            <li class="bottom-nav-item active">
                <a href="index.php" class="bottom-nav-link">
                    <i class="fas fa-fw fa-home"></i>
                    <span>Início</span>
                </a>
            </li>
            <li class="bottom-nav-item">
                <a data-toggle="modal" data-target="#loginModal" class="bottom-nav-link">
                    <i class="fas fa-fw fa-handshake"></i>
                    <span>Contatos</span>
                </a>
            </li>
            <li class="bottom-nav-item">
                <a data-toggle="modal" data-target="#cadastroModal" class="bottom-nav-link">
                    <i class="fas fa-fw fa-handshake"></i>
                    <span>Cadastrar-se</span>
                </a>
            </li>
            <li class="bottom-nav-item">
                <a href="cadastra-evento.html" class="bottom-nav-link">
                    <i class="fas fa-fw fa-handshake"></i>
                    <span>Publicar</span>
                </a>
            </li>

        </ul>
    </div>

    <div id="wrapper">
        <ul class="sidebar toggled navbar-nav" style="background: #f50136;">
            <li class="nav-item active">
                <a class="nav-link" href="#page-top">
                    <i class="fas fa-fw fa-home"></i>
                    <span>Início</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="modal" data-target="#loginModal">
                    <i class="fas fa-fw fa-handshake"></i>
                    <span>Contatos</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="modal" data-target="#cadastroModal">
                    <i class="fas fa-fw fa-handshake"></i>
                    <span>Cadastrar-se</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="cadastra-evento.html">
                    <i class="fas fa-fw fa-handshake"></i>
                    <span>Publicar evento</span>
                </a>
            </li>
        </ul>

        <div id="content-wrapper">
           
            <section id="read-qrCode" style="background: white;">
                <div class="container">
                    <div class="row">
                        <div class="col offset-lg-8 mx-auto text-center">
                            <h2 class="section-heading">Gerir contatos</h2>
                            <hr class="my-4">
                            <button class="btn btn-primary" id="btnFornece"
                                data-toggle="modal" data-target="#forneceModal">
                                Fornecer meu contato
                            </button>
                            <br><br>
                            <button class="btn btn-primary" id="btnAdiciona"
                                data-toggle="modal" data-target="#adicionaModal">
                                Adicionar novo contato
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="financiamento" class="bg-primary">
                <div class="container">
                    <div class="row">
                        <div class="col offset-lg-8 mx-auto text-center" id="divContato">
                            <h2 class='text-white section-heading'>Contatos atuais</h2>
                            <hr class='light my-4'>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>


    <!-- Adiciona Modal -->
    <div id="forneceModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Meu contato</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body" style="align-content: center; text-align: center;">
                    <img src="img/qrCode.png">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="adicionaModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Adicionar contato</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body" style="align-content: center; text-align: center;">
                    <video id="preview" style="max-height: 60% !important; max-width: 60% !important;"></video>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modelDados" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Dados do contato</h3>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    </div>
                    <div class="modal-body" style="align-content: center; text-align: center;" id="dentroModal">
                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.1.1/aos.js"></script>
    <script src="assets/js/floatLabels.js"></script>
    <script src="assets/js/script.min.js"></script>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {

            let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });

            scanner.addListener('scan', function (content) {
                var json = JSON.parse(content)[0];

                if (json.hasOwnProperty('cpfCnpj')) {

                    /*console.log("json.cpfCnpj: "+json.cpfCnpj);
                    console.log("json.nome: "+json.nome);
                    console.log("json.email: "+json.email);
                    console.log("json.Linkedin: "+json.Linkedin);*/
                    adicionaElemento(json);

                    $('#adicionaModal').modal('toggle');

                    alert("Contato adicionado.");

                } else {
                    console.log('Participante');
                }
/*
{
    "cpfCnpj": 123456,
    "nome": "Douglas Nunes",
    "email": "douglas.nunes@ifsuldeminas.edu.br",
    "Linkedin": "linkedin.com/douglas.nunes"
}
*/
            });

            $("#btnAdiciona").click(function () {
                Instascan.Camera.getCameras().then(function (cameras) {

                    if (cameras.length > 1) {
                        scanner.start(cameras[1]);

                    } else if (cameras.length > 0) {
                        scanner.start(cameras[0]);

                    } else {
                        console.error('No cameras found.');
                    }

                }).catch(function (e) {
                    console.error(e);
                });
            });


            $('#adicionaModal').on('hidden.bs.modal', function (e) {
                scanner.stop();
            });
        });

        function adicionaElemento(json) {
            let string = "";
            string += "<a data-toggle='modal' data-target='#modelDados' onClick='adicionaDentroModal();'>";
            string += "<div class='col-8 offset-2 botaoEvento'>";
            string += "Nome: "+json.nome+"<br>";
            string += "Email: "+json.email+"<br>";
            string += "</div></a><br>";
            $( "#divContato" ).append(string);
        }

        function adicionaDentroModal(json) {
            let string = "";
            string += "Nome: "+json.nome+"<br>";
            string += "Email: "+json.email+"<br>";
            string += "Linkedin: "+json.Linkedin+"<br>";
            $( "#dentroModal" ).append(string);
            
        }


    </script>

</body>

</html>